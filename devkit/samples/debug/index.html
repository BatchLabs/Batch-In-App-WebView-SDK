<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, viewport-fit=cover">
  <script src="/batch-webview-sdk.min.js"></script>
</head>
<body style="background: #d3d3d3;">
<h1>Batch Javascript Interface Tester</h1>
<div id="output"></div>
<br>
<button id="action" disabled>action deeplink</button>
<button id="track" disabled>track click</button>
<button id="close" disabled>close</button>
<button id="throw" disabled>throw</button>
<br>
<h2>Batch Links Tester</h2>
<a href="https://batch.com/index.html?batchAnalyticsID=test_blank_id" target="_blank">target = _blank</a>
<br>
<a href="https://batch.com/">without target</a>
<br>
<button id="doc-close" disabled>Call document.close()</button>
<button id="win-close" disabled>Call window.close()</button>
<button id="alert-btn" disabled>Call window.alert()</button>
<button id="confirm-btn" disabled>Call window.confirm()</button>
<button id="prompt-btn" disabled>Call window.prompt()</button>

<script>
  var output = document.getElementById('output')

  function asyncPrintData(name, method) {
    method.then((result) => {
      output.innerHTML += name + ': '
      if (typeof result === "undefined") {
        output.innerHTML += "<i>No value set</i>";
      } else {
        output.innerHTML += result;
      }
      output.innerHTML += '<br>';
    }).catch((err) => {
      output.innerHTML += name + ': ' + 'Error: ' + err + '<br>';
    });
  }

  if (typeof window.batchInAppSDK !== "undefined") {
    // Write out all of the getters
    asyncPrintData('Advertising Id', batchInAppSDK.getAdvertisingID());
    asyncPrintData('Installation Id', batchInAppSDK.getInstallationID());
    asyncPrintData('Custom Region', batchInAppSDK.getCustomRegion());
    asyncPrintData('Custom Language', batchInAppSDK.getCustomLanguage());
    asyncPrintData('Custom User Id', batchInAppSDK.getCustomUserID());
    asyncPrintData('Custom Payload', batchInAppSDK.getCustomPayload().then(p => JSON.stringify(p)));
    asyncPrintData('Tracking Id', batchInAppSDK.getTrackingID());
  }

  var actionButton = document.getElementById('action')
  actionButton.disabled = false
  actionButton.addEventListener('click', function()  {
    batchInAppSDK.performAction('batch.deeplink', {'l':'https://batch.com/'}, "test_action")
  })

  var closeButton = document.getElementById('close')
  closeButton.disabled = false
  closeButton.addEventListener('click', function()  {
    batchInAppSDK.dismiss("test_dismiss")
  })

  var throwButton = document.getElementById('throw')
  throwButton.disabled = false
  throwButton.addEventListener('click', function()  {
    throw 'I\'m a Javascript exception';
  })

  var docCloseButton = document.getElementById('doc-close')
  docCloseButton.disabled = false
  docCloseButton.addEventListener('click', function()  {
    document.close()
  })

  var winCloseButton = document.getElementById('win-close')
  winCloseButton.disabled = false
  winCloseButton.addEventListener('click', function()  {
    window.close()
  })

  var alertButton = document.getElementById('alert-btn')
  alertButton.disabled = false
  alertButton.addEventListener('click', function()  {
    window.alert('Salut Alert')
  })

  var promptButton = document.getElementById('prompt-btn')
  promptButton.disabled = false
  promptButton.addEventListener('click', function()  {
    window.alert("Result: " + window.prompt('Salut Prompt', 'foo'))
  })

  var confirmButton = document.getElementById('confirm-btn')
  confirmButton.disabled = false
  confirmButton.addEventListener('click', function()  {
    window.alert("Result: " + window.confirm('Salut Confirm'))
  })
</script>
</body>
</html>